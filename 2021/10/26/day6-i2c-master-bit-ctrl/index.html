<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"t1ina2003.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="è§£æä¾†è‡ªæ–¼OpenCoresç¶²ç«™ä¸Šçš„I2Cå…ƒä»¶maintainersæ˜¯Richard Herveilleå…¶ä¸­specéƒ¨åˆ†ç¬¬äº”ç« Architectureå…±åˆ†ç‚º9å€‹å…ƒä»¶ï¼šå…ˆæ¢è¨æœ€åŸºæœ¬å…ƒä»¶ä¹‹ä¸€ Bit Command Controller">
<meta property="og:type" content="article">
<meta property="og:title" content="day6-i2c-master_bit_ctrl">
<meta property="og:url" content="http://t1ina2003.github.io/2021/10/26/day6-i2c-master-bit-ctrl/index.html">
<meta property="og:site_name" content="zswang&#39;s blog">
<meta property="og:description" content="è§£æä¾†è‡ªæ–¼OpenCoresç¶²ç«™ä¸Šçš„I2Cå…ƒä»¶maintainersæ˜¯Richard Herveilleå…¶ä¸­specéƒ¨åˆ†ç¬¬äº”ç« Architectureå…±åˆ†ç‚º9å€‹å…ƒä»¶ï¼šå…ˆæ¢è¨æœ€åŸºæœ¬å…ƒä»¶ä¹‹ä¸€ Bit Command Controller">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2021-10-26T03:24:02.000Z">
<meta property="article:modified_time" content="2021-12-02T16:36:42.319Z">
<meta property="article:author" content="zswang">
<meta property="article:tag" content="verilog">
<meta property="article:tag" content="i2c">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://t1ina2003.github.io/2021/10/26/day6-i2c-master-bit-ctrl/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-TW'
  };
</script>

  <title>day6-i2c-master_bit_ctrl | zswang's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <meta name="google-site-verification" content="ccwy9EYuprx_2qpxqYbyknEnB0zAULlTVbcqa6efO_w" />
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ›å°èˆªæ¬„">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">zswang's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é </a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>æ­¸æª”</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://t1ina2003.github.io/2021/10/26/day6-i2c-master-bit-ctrl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zswang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="zswang's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          day6-i2c-master_bit_ctrl
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">ç™¼è¡¨æ–¼</span>

              <time title="å‰µå»ºæ™‚é–“ï¼š2021-10-26 11:24:02" itemprop="dateCreated datePublished" datetime="2021-10-26T11:24:02+08:00">2021-10-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°æ–¼</span>
                <time title="ä¿®æ”¹æ™‚é–“ï¼š2021-12-03 00:36:42" itemprop="dateModified" datetime="2021-12-03T00:36:42+08:00">2021-12-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†é¡æ–¼</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/verilog/" itemprop="url" rel="index"><span itemprop="name">verilog</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>è§£æä¾†è‡ªæ–¼OpenCoresç¶²ç«™ä¸Šçš„<a target="_blank" rel="noopener" href="http://www.opencores.org/projects/i2c/">I2Cå…ƒä»¶</a><br>maintainersæ˜¯Richard Herveille<br>å…¶ä¸­specéƒ¨åˆ†ç¬¬äº”ç« Architectureå…±åˆ†ç‚º9å€‹å…ƒä»¶ï¼š<br>å…ˆæ¢è¨æœ€åŸºæœ¬å…ƒä»¶ä¹‹ä¸€ <code>Bit Command Controller</code></p>
<a id="more"></a>
<ul>
<li>åƒè€ƒæ–‡ä»¶:<ul>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/357802551">I2Cåè®®åŠVerilogå®ç°ä¸ä»¿çœŸï¼ˆä¸€ï¼‰</a><ul>
<li>è§£é‡‹ç·šè·¯æ¥æ³•</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://www.twblogs.net/a/5b8301342b717766a1eab382">Verilogä¹‹i2cå”è­°</a><ul>
<li>I2Cç°¡æ½”ç‰ˆ</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/muxi_huang/article/details/105342916">Opencoresä¸Šçš„i2c controller coreä»£ç è§£æ</a><ul>
<li>å°æ–¼clkåˆ†é »å–æ¨£æœ‰è§£é‡‹</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://www.itread01.com/content/1548954903.html">ç§»æ¤OPENCORESä¸Šçš„I2C MASTERåˆ°AXIä»‹é¢è™•ç†å™¨å±¤é¢å¯¦ç¾é©…å‹• ä¹‹ä¸€</a><ul>
<li>ç§»æ¤çš„éƒ¨åˆ†</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://www.twblogs.net/a/5f9e464447b134b550a72d29">Verification of WISHBONE I2C Master Core(IRUN+Simvision)</a><ul>
<li>simçš„ç”¨æ³•</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="ç¸½åœ–"><a href="#ç¸½åœ–" class="headerlink" title="ç¸½åœ–"></a>ç¸½åœ–</h1><p>(å–è‡ªå…¶èªªæ˜æ–‡ä»¶)  </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚Prescale â”‚                               â”‚clock       â”‚</span><br><span class="line">â”‚Register â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€clk_cntâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚generator   â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜</span><br><span class="line">                                             â–²   clk_en</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              scl_sync  â–¼</span><br><span class="line">â”‚Command  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚Register â”œâ”€â”€â”€â”€â”€â–ºâ”‚            â”‚           â”‚            â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ Byte       â”œâ”€core_cmdâ”€â–ºâ”‚ Bit        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–º SCL</span><br><span class="line">                 â”‚ Command    â”‚           â”‚ Command    â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ Controller â”‚â—„â”€core_ackâ”€â”¤ Controller â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–º SDA</span><br><span class="line">â”‚Status   â”‚â—„â”€â”€â”€â”€â”€â”¤            â”‚           â”‚            â”‚</span><br><span class="line">â”‚Register â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â–²    â”‚</span><br><span class="line">                                              â”‚    â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚    â”‚</span><br><span class="line">â”‚Transmit â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚</span><br><span class="line">â”‚Register â”œâ”€â”€â”€â”€â”€â–ºâ”‚            â”‚               â”‚    â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ DataIO     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚</span><br><span class="line">                 â”‚ Shift      â”‚                    â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ Register   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â”‚Receive  â”‚â—„â”€â”€â”€â”€â”€â”¤            â”‚</span><br><span class="line">â”‚Register â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<h1 id="bit-controller-å€å¡Šåœ–"><a href="#bit-controller-å€å¡Šåœ–" class="headerlink" title="bit controller å€å¡Šåœ–"></a>bit controller å€å¡Šåœ–</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### è¨Šè™Ÿæ•æ‰</span><br><span class="line">            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”</span><br><span class="line">            â”‚             â”‚         â”‚     â”‚</span><br><span class="line"> scl_iâ”€â”€â”€â”€â”€â–ºâ”‚  capture    â”œâ”€â”€â–ºsSCLâ”€â–ºâ”‚     â”œâ”€â”€â”€â”€â–ºdSCL</span><br><span class="line">            â”‚  &amp;          â”‚         â”‚ dff â”‚</span><br><span class="line"> sda_iâ”€â”€â”€â”€â”€â–ºâ”‚  filtered   â”œâ”€â”€â–ºsSDAâ”€â–ºâ”‚     â”œâ”€â”€â”€â”€â–ºdSDA</span><br><span class="line">            â”‚             â”‚         â”‚     â”‚</span><br><span class="line">            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br><span class="line">### ç‹€æ…‹æ©Ÿ</span><br><span class="line">            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” scl_oen</span><br><span class="line"> nResetâ”€â”€â”€â”€â–ºâ”‚             â”‚ clk_en  â”‚           â”‚ sda_oen</span><br><span class="line">            â”‚             â”‚ nReset  â”‚           â”‚ cmd_ack</span><br><span class="line">    rstâ”€â”€â”€â”€â–ºâ”‚ clk enable  â”‚ rst     â”‚ FSM       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º</span><br><span class="line">            â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚ sda_chk</span><br><span class="line">    enaâ”€â”€â”€â”€â–ºâ”‚             â”‚         â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚</span><br><span class="line">### ç‹€æ³åˆ¤æ–·                                                â”‚</span><br><span class="line">  sSCL      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            sda_oen     sSDA    â”‚</span><br><span class="line">  â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚            â”€â”€â”€â”€â”€â”€â”€â”€â”  â”€â”€â”€â”€â”€â”€â”  â”‚</span><br><span class="line">  dSCL      â”‚             â”‚                    â–¼        â–¼  â–¼</span><br><span class="line">  â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ scl_sync    â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">            â”‚             â”‚                 â”‚                   â”‚</span><br><span class="line">        â”Œâ”€â”€â–ºâ”‚             â”‚                 â”‚                   â”‚</span><br><span class="line">        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ aribitration lost â”‚   al</span><br><span class="line">        â”‚                                   â”‚                   â”œâ”€â”€â”€â”€â–º</span><br><span class="line">        â”‚   â”Œâ”€â”€â”€â”€â”€â”                         â”‚                   â”‚</span><br><span class="line">        â”‚   â”‚     â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">scl_oenâ”€â”¼â”€â”€â–ºâ”‚ dff â”‚                                         â–² â–²</span><br><span class="line">        â”‚   â”‚     â”‚                                 c_state â”‚ â”‚</span><br><span class="line">        â”‚   â””â”€â”¬â”€â”€â”€â”˜            sSCL                 â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span><br><span class="line">        â”‚     â”‚ dscl_oen       sSDA  â”Œâ”€â”€â”€â”€â”€â”€â”€â”                â”‚</span><br><span class="line">        â”‚     â–¼                â”€â”€â”€â”€â”€â–ºâ”‚       â”‚sta_condition   â”‚</span><br><span class="line">        â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ START â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚</span><br><span class="line">        â””â”€â”€â–ºâ”‚             â”‚    dSCL  â”‚ &amp;     â”‚sto_condition   â”‚</span><br><span class="line">   sSCL     â”‚ slave_wait  â”‚    dSDA  â”‚ STOP  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">  â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚    â”€â”€â”€â”€â”€â–ºâ”‚       â”‚</span><br><span class="line">            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="é—œæ–¼rst"><a href="#é—œæ–¼rst" class="headerlink" title="é—œæ–¼rst"></a>é—œæ–¼rst</h1><p>ç³»çµ±ä¸­åˆ†ç‚ºhigh active <code>rst</code>, è·Ÿlow active <code>nReset</code>,<br>æ­£ç¢ºè§¸ç™¼æ–¹å¼ç‚ºå…ˆ <code>nReset</code><br>å†æ­£ <code>rst</code> ä¸€æ¬¡</p>
<br>

<blockquote>
<p>åŸå§‹ç¢¼é †åºç‚ºç‹€æ³åˆ¤æ–·(1/2), è¨Šè™Ÿæ•æ‰, ç‹€æ³åˆ¤æ–·(2/2), ç‹€æ…‹æ©Ÿ<br>ä»¥ä¸‹æ ¹æ“šåŸå§‹ç¢¼é †åºé€²è¡Œåˆ†æ</p>
</blockquote>
<br>

<h1 id="PART1-ç‹€æ³åˆ¤æ–·-1-2"><a href="#PART1-ç‹€æ³åˆ¤æ–·-1-2" class="headerlink" title="PART1 ç‹€æ³åˆ¤æ–·(1/2)"></a>PART1 ç‹€æ³åˆ¤æ–·(1/2)</h1><br>

<h2 id="slave-wait-Clock-Stretching"><a href="#slave-wait-Clock-Stretching" class="headerlink" title="slave_wait (Clock Stretching)"></a>slave_wait (Clock Stretching)</h2><p>slave å¿™ç¢Œ, æœƒå°‡SCLæ‹‰ä½, ç¨±ç‚º<code>Clock Stretching</code></p>
<ul>
<li>å¦‚æœmaster<code>scl_oen</code>è¼¸å‡ºhigh, å»æ”¶åˆ°ä½<code>sSCL</code>, å‰‡slaveå¿™ç¢Œä¸­  </li>
<li>å¦‚æœslaveå¿™ç¢Œä¸­, <code>sSCL</code>æœªæ‹‰é«˜ä¹‹å‰, å‰‡slaveå¿™ç¢Œä¸­  </li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> nReset)</span><br><span class="line">  <span class="keyword">if</span> (!nReset) slave_wait &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">  <span class="keyword">else</span>         slave_wait &lt;= (scl_oen &amp; ~dscl_oen &amp; ~sSCL) | (slave_wait &amp; ~sSCL);</span><br></pre></td></tr></table></figure>
<br>

<h2 id="scl-sync-Clock-Synchronization"><a href="#scl-sync-Clock-Synchronization" class="headerlink" title="scl_sync (Clock Synchronization)"></a>scl_sync (Clock Synchronization)</h2><p>ç·šè·¯ä¸­å­˜åœ¨å¤šå€‹master, å½¼æ­¤é–“åŒæ­¥SCLé »ç‡, ç¨±ç‚º <code>Clock Synchronization</code></p>
<ul>
<li>ç•¶è£ç½®scl_oenç‚ºhigh, å…¶ä»–è£ç½®æŠŠSCLæ‹‰ä½æ™‚, å°±æœƒç™¼å‡º scl_sync è¨Šè™Ÿ</li>
<li>ç™¼å‡º scl_sync è¨Šè™Ÿå°‡å°è‡´ clk enable signal é‡æ–°è¨ˆæ•¸</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">wire</span> scl_sync   = dSCL &amp; ~sSCL &amp; scl_oen;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…¶å¯¦ <code>slave_wait</code> è·Ÿ <code>scl_sync</code> å¾ˆç›¸ä¼¼<br>åªæ˜¯ <code>slave_wait</code> æ˜¯ SCL æƒ³ high å»é‚„æ˜¯ low<br>åªæ˜¯ <code>scl_sync</code> æ˜¯ SCL è©² high æ™‚è¢«æ‹‰ low<br>masterå°é€™å…©è€…æ¡å–å¦¥å”æ”¿ç­–,<br><code>slave_wait</code> ç­‰å¾…SCL, <code>scl_sync</code> è·Ÿéš¨ SCL</p>
</blockquote>
<br>

<h2 id="clk-enable-signal-é™¤é »"><a href="#clk-enable-signal-é™¤é »" class="headerlink" title="clk enable signal é™¤é »"></a>clk enable signal é™¤é »</h2><p>é™¤é », çµ¦ç‹€æ…‹æ©Ÿä½¿ç”¨</p>
<ul>
<li>å…ˆæ”¾é–‹ nReset, å†æ”¾é–‹ rst, ä¸”é–‹å•Ÿ en</li>
<li>æ ¹æ“š clk_cnt(clock prescale value) é™¤é », çµ¦å‡º clk_en ä¾› FSM ä½¿ç”¨</li>
<li>æ ¹æ“š scl_sync å¯¦ä½œ <code>Clock Synchronization</code></li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> nReset)</span><br><span class="line">  <span class="keyword">if</span> (~nReset)</span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">      cnt    &lt;= #<span class="number">1</span> <span class="number">16&#x27;h0</span>;</span><br><span class="line">      clk_en &lt;= #<span class="number">1</span> <span class="number">1&#x27;b1</span>;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (rst || ~|cnt || !ena || scl_sync)</span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">      cnt    &lt;= #<span class="number">1</span> clk_cnt;</span><br><span class="line">      clk_en &lt;= #<span class="number">1</span> <span class="number">1&#x27;b1</span>;</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (slave_wait)</span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">      cnt    &lt;= #<span class="number">1</span> cnt;</span><br><span class="line">      clk_en &lt;= #<span class="number">1</span> <span class="number">1&#x27;b0</span>;    </span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">      cnt    &lt;= #<span class="number">1</span> cnt - <span class="number">16&#x27;h1</span>;</span><br><span class="line">      clk_en &lt;= #<span class="number">1</span> <span class="number">1&#x27;b0</span>;</span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<br>

<h1 id="PART2-è¨Šè™Ÿæ•æ‰"><a href="#PART2-è¨Šè™Ÿæ•æ‰" class="headerlink" title="PART2 è¨Šè™Ÿæ•æ‰"></a>PART2 è¨Šè™Ÿæ•æ‰</h1><br>

<h2 id="æ•æ‰-cSCL-cSDA-è¨Šè™Ÿ"><a href="#æ•æ‰-cSCL-cSDA-è¨Šè™Ÿ" class="headerlink" title="æ•æ‰ cSCL, cSDA è¨Šè™Ÿ"></a>æ•æ‰ cSCL, cSDA è¨Šè™Ÿ</h2><p>æ•æ‰çª—æ ¼ç‚º2å€‹ posedge clk, æ¸›ä¾›çµ¦å¾ŒçºŒ filter ä½¿ç”¨ </p>
<ul>
<li> è¼¸å…¥è¨Šè™Ÿ scl_i, sda_i æœƒæ…¢æ…¢ä½ç§»é€² cSCL, cSDA.  </li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">reg</span> [ <span class="number">1</span>:<span class="number">0</span>] cSCL, cSDA;      <span class="comment">// capture SCL and SDA</span></span><br><span class="line"><span class="comment">// capture SDA and SCL</span></span><br><span class="line"><span class="comment">// reduce metastability risk</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> nReset)</span><br><span class="line">      cSCL &lt;= &#123;cSCL[<span class="number">0</span>],scl_i&#125;;</span><br><span class="line">      cSDA &lt;= &#123;cSDA[<span class="number">0</span>],sda_i&#125;;</span><br></pre></td></tr></table></figure>
<br>

<h2 id="æ“·å–-fSCL-fSDA-è¨Šè™Ÿ"><a href="#æ“·å–-fSCL-fSDA-è¨Šè™Ÿ" class="headerlink" title="æ“·å– fSCL, fSDA è¨Šè™Ÿ"></a>æ“·å– fSCL, fSDA è¨Šè™Ÿ</h2><p>è‹¥ç³»çµ±é »ç‡50MHz, clk_cntè‹¥è¨­ç‚º125, å‰‡clk_enç‚º400KHz, filter_cntå†ä½ç§»2 bit, å‰‡æ˜¯å¤§ç´„1.6MHz.  </p>
<ul>
<li>å°‡ clock prescale value é™¤ä»¥å››ç•¶ä½œæ“·å–é »ç‡</li>
<li>è¼¸å…¥è¨Šè™Ÿ scl_i, sda_i æœƒæ…¢æ…¢ä½ç§»é€² fSCL, fSDA. </li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">257</span><br><span class="line">258</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (~|filter_cnt) filter_cnt &lt;= clk_cnt &gt;&gt; <span class="number">2</span>; <span class="comment">//16x I2C bus frequency</span></span><br><span class="line"><span class="keyword">else</span>                   filter_cnt &lt;= filter_cnt -<span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> nReset)</span><br><span class="line">      fSCL &lt;= &#123;fSCL[<span class="number">1</span>:<span class="number">0</span>],cSCL[<span class="number">1</span>]&#125;;</span><br><span class="line">      fSDA &lt;= &#123;fSDA[<span class="number">1</span>:<span class="number">0</span>],cSDA[<span class="number">1</span>]&#125;;</span><br></pre></td></tr></table></figure>
<br>

<h2 id="æ“·å–å®ŒæˆsSCL-sSDA-å»¶é²-dSCL-dSDA"><a href="#æ“·å–å®ŒæˆsSCL-sSDA-å»¶é²-dSCL-dSDA" class="headerlink" title="æ“·å–å®ŒæˆsSCL, sSDA, å»¶é² dSCL, dSDA"></a>æ“·å–å®ŒæˆsSCL, sSDA, å»¶é² dSCL, dSDA</h2><p>ç”¢å‡ºä¹‹è¨Šè™Ÿå¯æ¸›å°‘ metastability é¢¨éšª</p>
<ul>
<li>è‹¥ <code>fSCL</code> ä¸­æœ‰ä»»æ„ å…©å€‹å€¼ç‚º 1ï¼Œå‰‡<code>sSCL</code>ç‚ºHigh  </li>
<li>è‹¥ <code>fSDA</code> ä¸­æœ‰ä»»æ„ å…©å€‹å€¼ç‚º 1ï¼Œå‰‡<code>sSDA</code>ç‚ºHigh</li>
<li>ç”¢ç”Ÿå„è‡ªçš„delayè¨Šè™Ÿ</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> nReset)</span><br><span class="line">      sSCL &lt;= #<span class="number">1</span> &amp;fSCL[<span class="number">2</span>:<span class="number">1</span>] | &amp;fSCL[<span class="number">1</span>:<span class="number">0</span>] | (fSCL[<span class="number">2</span>] &amp; fSCL[<span class="number">0</span>]);</span><br><span class="line">      sSDA &lt;= #<span class="number">1</span> &amp;fSDA[<span class="number">2</span>:<span class="number">1</span>] | &amp;fSDA[<span class="number">1</span>:<span class="number">0</span>] | (fSDA[<span class="number">2</span>] &amp; fSDA[<span class="number">0</span>]);</span><br><span class="line">      dSCL &lt;= #<span class="number">1</span> sSCL;</span><br><span class="line">      dSDA &lt;= #<span class="number">1</span> sSDA;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å‡è¨­åœ¨50MHzçš„é »ç‡ä¸‹ï¼Œ<code>cSCL[0]</code>, <code>cSCL[1]</code>, <code>fSCL[0]</code>, <code>fSCL[1]</code>, <code>fSCL[2]</code>,<br>å»¶é²åˆ†åˆ¥ç‚º  T, T-20ns, T-1020ns, T-2020ns, T-3020ns<br>è€Œä¸€å€‹400KHzçš„I2Cè¨Šè™Ÿé–“éš”è‡³å°‘2500ns, æ­¤è™•ç®—æ˜¯æŠ“çš„ç´°äº†ä¸€é».<br>æ­¤è™•å¯ä»¥çœ‹æˆå¾ˆåš´æ ¼ç›£æ¸¬è¨Šè™Ÿç‚º 0 çš„ç‹€æ…‹, åªè¦æœ‰å¹¾å€‹ 1 å°±ä¸ç‚º 0 </p>
</blockquote>
<br>

<h1 id="Part3-ç‹€æ³åˆ¤æ–·-2-2"><a href="#Part3-ç‹€æ³åˆ¤æ–·-2-2" class="headerlink" title="Part3 ç‹€æ³åˆ¤æ–·(2/2)"></a>Part3 ç‹€æ³åˆ¤æ–·(2/2)</h1><br>

<h2 id="é–‹å§‹çµæŸ-START-STOP"><a href="#é–‹å§‹çµæŸ-START-STOP" class="headerlink" title="é–‹å§‹çµæŸ START, STOP"></a>é–‹å§‹çµæŸ START, STOP</h2><p>æ­¤è™•ç”¨å…©å€‹æš«å­˜å™¨ç›£æ¸¬START, STOPå…©å€‹ç‹€æ…‹,<br>è¨Šè™Ÿæ˜¯ä½¿ç”¨éæ¿¾å¥½çš„ <code>sSCL</code>, <code>sSDA</code><br><code>sSCL</code>ç‚ºé«˜,<code>sSDA</code>ç”±é«˜è½‰ä½,ç¨±ç‚ºSTART<br><code>sSCL</code>ç‚ºé«˜,<code>sSDA</code>ç”±ä½è½‰é«˜,ç¨±ç‚ºSTOP</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">reg</span> sta_condition;</span><br><span class="line"><span class="keyword">reg</span> sto_condition;</span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> nReset)</span><br><span class="line">      sta_condition &lt;= #<span class="number">1</span> ~sSDA &amp;  dSDA &amp; sSCL;</span><br><span class="line">      sto_condition &lt;= #<span class="number">1</span>  sSDA &amp; ~dSDA &amp; sSCL;</span><br></pre></td></tr></table></figure>
<br>

<h2 id="å¿™ç¢Œè¨Šè™Ÿ-Busy"><a href="#å¿™ç¢Œè¨Šè™Ÿ-Busy" class="headerlink" title="å¿™ç¢Œè¨Šè™Ÿ Busy"></a>å¿™ç¢Œè¨Šè™Ÿ Busy</h2><p>rstéå¾Œä¸busy<br>STARTå¾Œbusy<br>busyæ™‚busy<br>STOPå¾Œä¸busy</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> nReset)</span><br><span class="line">  <span class="keyword">if</span>      (!nReset) busy &lt;= #<span class="number">1</span> <span class="number">1&#x27;b0</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (rst    ) busy &lt;= #<span class="number">1</span> <span class="number">1&#x27;b0</span>;</span><br><span class="line">  <span class="keyword">else</span>              busy &lt;= #<span class="number">1</span> (sta_condition | busy) &amp; ~sto_condition;</span><br></pre></td></tr></table></figure>
<br>

<h2 id="çˆ­è¼¸è´Arbitration-Lost"><a href="#çˆ­è¼¸è´Arbitration-Lost" class="headerlink" title="çˆ­è¼¸è´Arbitration Lost"></a>çˆ­è¼¸è´Arbitration Lost</h2><p>ä»²è£è¼¸æ‰åˆ†ç‚ºå…©å€‹éƒ¨åˆ†:</p>
<ol>
<li>(åƒ…wr_cç‹€æ…‹, æ‰åš<code>sda_chks</code>)ç•¶masterå˜—è©¦å¯«<code>sda_oen</code>(è¼¸å‡º)ç‚ºé«˜, å»ç™¼ç¾ç„¡æ³•, ä¸¦åµæ¸¬åˆ°<code>sSDA</code>(è¼¸å…¥)ç‚ºä½, è¼¸æ‰ä»²è£(åœ°å€å°çš„å„ªå…ˆ)  </li>
</ol>
<p>æˆ–  </p>
<ol start="2">
<li>æ²’æœ‰IDLEæ™‚(å‚³è¼¸é€”ä¸­), æ”¶åˆ°STOPè¨Šè™Ÿ(ç¸½ç·šä¸Šé¢æ„Ÿæ¸¬åˆ°), é‚„æ²’åˆ°è½‰stateçš„æ®µè½, ä»²è£å°±è¼¸æ‰</li>
</ol>
<p>ä»²è£è¼¸æ‰ä¸»è¦å°è‡´topéƒ¨åˆ†æœƒå°‡è³‡æ–™é‡å¯«æˆ–è€…é‡è®€. ä¸€æ—¦ä»²è£è¼¸æ‰å°±æœƒè®“byte-ctrlå›åˆ°IDLEç‹€æ…‹</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">reg</span> cmd_stop;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> nReset)</span><br><span class="line">      <span class="keyword">if</span> (~nReset)</span><br><span class="line">          cmd_stop &lt;= #<span class="number">1</span> <span class="number">1&#x27;b0</span>;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (rst)</span><br><span class="line">          cmd_stop &lt;= #<span class="number">1</span> <span class="number">1&#x27;b0</span>;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (clk_en)</span><br><span class="line">          cmd_stop &lt;= #<span class="number">1</span> cmd == <span class="meta">`I2C_CMD_STOP;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> nReset)</span><br><span class="line">      <span class="keyword">if</span> (~nReset)</span><br><span class="line">          al &lt;= #<span class="number">1</span> <span class="number">1&#x27;b0</span>;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (rst)</span><br><span class="line">          al &lt;= #<span class="number">1</span> <span class="number">1&#x27;b0</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">          al &lt;= #<span class="number">1</span> (sda_chk &amp; ~sSDA &amp; sda_oen) | (|c_state &amp; sto_condition &amp; ~cmd_stop);</span><br></pre></td></tr></table></figure>
<br>

<h1 id="PART4-ç‹€æ…‹æ©Ÿ"><a href="#PART4-ç‹€æ…‹æ©Ÿ" class="headerlink" title="PART4 ç‹€æ…‹æ©Ÿ"></a>PART4 ç‹€æ…‹æ©Ÿ</h1><h2 id="dout"><a href="#dout" class="headerlink" title="dout"></a>dout</h2><p>iSCLä¸Šå‡æ™‚è®€å–iSDAé€é€²å»çµ¦SR(ShiftRegister)</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">358</span><br><span class="line">359</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)</span><br><span class="line">      <span class="keyword">if</span> (sSCL &amp; ~dSCL) dout &lt;= #<span class="number">1</span> sSDA;</span><br></pre></td></tr></table></figure>
<h2 id="FSM"><a href="#FSM" class="headerlink" title="FSM"></a>FSM</h2><p>rst æ™‚ ä¸çµ¦ack, scl,sdaè¼¸å‡ºæ›z, ä¸æª¢æŸ¥sda<br>å…¶é¤˜ç‹€æ…‹å¦‚ä¸‹:</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br></pre></td><td class="code"><pre><span class="line">idle    : I2C_CMD_START,I2C_CMD_STOP,I2C_CMD_WRITE,I2C_CMD_READé¸ä¸€å€‹</span><br><span class="line">start_a : SCL x SDA H </span><br><span class="line">start_b : SCL H SDA H</span><br><span class="line">start_c : SCL H SDA L </span><br><span class="line">start_d : SCL H SDA L </span><br><span class="line">start_e : SCL L SDA L  cmd_ack</span><br><span class="line">stop_a  : SCL L SDA L </span><br><span class="line">stop_b  : SCL H SDA L </span><br><span class="line">stop_c  : SCL H SDA L </span><br><span class="line">stop_d  : SCL H SDA H  cmd_ack</span><br><span class="line">rd_a    : SCL L SDA H </span><br><span class="line">rd_b    : SCL H SDA H</span><br><span class="line">rd_c    : SCL H SDA H </span><br><span class="line">rd_d    : SCL L SDA H  cmd_ack</span><br><span class="line">wr_a    : SCL L SDA=Din </span><br><span class="line">wr_b    : SCL H SDA=Din</span><br><span class="line">wr_c    : SCL H SDA=Din sda_chks</span><br><span class="line">wr_d    : SCL L SDA=Din cmd_ack</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/verilog/" rel="tag"># verilog</a>
              <a href="/tags/i2c/" rel="tag"># i2c</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/10/13/day5-verilog-button-debounce/" rel="prev" title="day5-verilog-button-debounce">
      <i class="fa fa-chevron-left"></i> day5-verilog-button-debounce
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/10/27/day7-i2c-master-bit-ctrl-%E6%A8%A1%E6%93%AC/" rel="next" title="day7-i2c-master-bit-ctrl-æ¨¡æ“¬">
      day7-i2c-master-bit-ctrl-æ¨¡æ“¬ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®éŒ„
        </li>
        <li class="sidebar-nav-overview">
          æœ¬ç«™æ¦‚è¦
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B8%BD%E5%9C%96"><span class="nav-number">1.</span> <span class="nav-text">ç¸½åœ–</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#bit-controller-%E5%8D%80%E5%A1%8A%E5%9C%96"><span class="nav-number">2.</span> <span class="nav-text">bit controller å€å¡Šåœ–</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%97%9C%E6%96%BCrst"><span class="nav-number">3.</span> <span class="nav-text">é—œæ–¼rst</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PART1-%E7%8B%80%E6%B3%81%E5%88%A4%E6%96%B7-1-2"><span class="nav-number">4.</span> <span class="nav-text">PART1 ç‹€æ³åˆ¤æ–·(1&#x2F;2)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#slave-wait-Clock-Stretching"><span class="nav-number">4.1.</span> <span class="nav-text">slave_wait (Clock Stretching)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scl-sync-Clock-Synchronization"><span class="nav-number">4.2.</span> <span class="nav-text">scl_sync (Clock Synchronization)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#clk-enable-signal-%E9%99%A4%E9%A0%BB"><span class="nav-number">4.3.</span> <span class="nav-text">clk enable signal é™¤é »</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PART2-%E8%A8%8A%E8%99%9F%E6%8D%95%E6%8D%89"><span class="nav-number">5.</span> <span class="nav-text">PART2 è¨Šè™Ÿæ•æ‰</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8D%95%E6%8D%89-cSCL-cSDA-%E8%A8%8A%E8%99%9F"><span class="nav-number">5.1.</span> <span class="nav-text">æ•æ‰ cSCL, cSDA è¨Šè™Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%93%B7%E5%8F%96-fSCL-fSDA-%E8%A8%8A%E8%99%9F"><span class="nav-number">5.2.</span> <span class="nav-text">æ“·å– fSCL, fSDA è¨Šè™Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%93%B7%E5%8F%96%E5%AE%8C%E6%88%90sSCL-sSDA-%E5%BB%B6%E9%81%B2-dSCL-dSDA"><span class="nav-number">5.3.</span> <span class="nav-text">æ“·å–å®ŒæˆsSCL, sSDA, å»¶é² dSCL, dSDA</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Part3-%E7%8B%80%E6%B3%81%E5%88%A4%E6%96%B7-2-2"><span class="nav-number">6.</span> <span class="nav-text">Part3 ç‹€æ³åˆ¤æ–·(2&#x2F;2)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%96%8B%E5%A7%8B%E7%B5%90%E6%9D%9F-START-STOP"><span class="nav-number">6.1.</span> <span class="nav-text">é–‹å§‹çµæŸ START, STOP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%99%E7%A2%8C%E8%A8%8A%E8%99%9F-Busy"><span class="nav-number">6.2.</span> <span class="nav-text">å¿™ç¢Œè¨Šè™Ÿ Busy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%88%AD%E8%BC%B8%E8%B4%8FArbitration-Lost"><span class="nav-number">6.3.</span> <span class="nav-text">çˆ­è¼¸è´Arbitration Lost</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PART4-%E7%8B%80%E6%85%8B%E6%A9%9F"><span class="nav-number">7.</span> <span class="nav-text">PART4 ç‹€æ…‹æ©Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#dout"><span class="nav-number">7.1.</span> <span class="nav-text">dout</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FSM"><span class="nav-number">7.2.</span> <span class="nav-text">FSM</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">zswang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">æ–‡ç« </span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">åˆ†é¡</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">æ¨™ç±¤</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zswang</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> å¼·åŠ›é©…å‹•
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  















    <div id="pjax">
  

  
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: '32px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: 'ğŸŒ“',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>

    </div>
</body>
</html>
